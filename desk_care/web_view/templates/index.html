{% extends 'base.html' %}

{% block content %}
            <!-- Sale & Revenue Start -->
            <div class="container-fluid pt-4 px-4">
                <div class="row g-4">
                    <div class="col-sm-6 col-xl-3">
                        <div class="bg-secondary rounded d-flex align-items-center justify-content-between p-4">
                            <i class="fa fa-chart-line fa-3x text-primary"></i>
                            <div class="ms-3">
                                <p class="mb-2">Temperature</p>
                                <h6 class="mb-0" style="color:green" id="temp">{{temp}} °C</h6>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6 col-xl-3">
                        <div class="bg-secondary rounded d-flex align-items-center justify-content-between p-4">
                            <i class="fa fa-chart-bar fa-3x text-primary"></i>
                            <div class="ms-3">
                                <p class="mb-2">CPU Performance (MHz)</p>
                                <h6 class="mb-0" style="color:orange;" id="cpu">{{freq["current"]}}</h6>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6 col-xl-3">
                        <div class="bg-secondary rounded d-flex align-items-center justify-content-between p-4">
                            <i class="fa fa-chart-area fa-3x text-primary"></i>
                            <div class="ms-3">
                                <p class="mb-2">Network</p>
                                <h6 class="mb-0" ><small id="network" style="color:greenyellow">Loading...</small></h6>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6 col-xl-3">
                        <div class="bg-secondary rounded d-flex align-items-center justify-content-between p-4">
                            <i class="fa fa-chart-pie fa-3x text-primary"></i>
                            <div class="ms-3">
                                <p class="mb-2">CPU/Memory/Disk</p>
                                <h6 class="mb-0">{{cpu}}%/{{memory}}%/{{disk}}%</h6>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Sale & Revenue End -->


            <!-- Sales Chart Start -->
            <div class="container-fluid pt-4 px-4">
                <div class="row g-4">
                    <div class="col-sm-12 col-xl-6">
                        <div class="bg-secondary text-center rounded p-4">
                            <div class="d-flex align-items-center justify-content-between mb-4">
                                <h6 class="mb-0">CPU Performance (MHz)</h6>
                            
                            </div>
                            <canvas id="cpu-performance-chart"></canvas>
                        </div>
                    </div>
                    <div class="col-sm-12 col-xl-6">
                        <div class="bg-secondary text-center rounded p-4">
                            <div class="d-flex align-items-center justify-content-between mb-4">
                                <h6 class="mb-0">Temperature Check (°C)</h6>
                              
                            </div>
                            <canvas id="cpu-temp-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Sales Chart End -->


            <!-- Recent Sales Start -->
            <div class="container-fluid pt-4 px-4">
                <div class="bg-secondary text-center rounded p-4">
                    <div class="d-flex align-items-center justify-content-between mb-4">
                        <h6 class="mb-0"></h6>
                        <a href="">Show All</a>
                    </div>
                    <div class="table-responsive">
                        <table class="table text-start align-middle table-bordered table-hover mb-0">
                            <thead>
                                <tr class="text-white">
                                   
                                </tr>
                            </thead>
                            <tbody>
                               
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <!-- Recent Sales End -->


            <!-- Widgets Start -->
            <div class="container-fluid pt-4 px-4">
                <div class="row g-4">
                    <div class="col-sm-12 col-md-6 col-xl-4">
                        <div class="h-100 bg-secondary rounded p-4">
                            <div class="d-flex align-items-center justify-content-between mb-2">
                                <h6 class="mb-0">Messages</h6>
                                <a href="">Show All</a>
                            </div>
                           >
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-6 col-xl-4">
                        <div class="h-100 bg-secondary rounded p-4">
                            <div class="d-flex align-items-center justify-content-between mb-4">
                                <h6 class="mb-0">Calender</h6>
                                <a href="">Show All</a>
                            </div>
                            <div id="calender"></div>
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-6 col-xl-4">
                        <div class="h-100 bg-secondary rounded p-4">
                            <div class="d-flex align-items-center justify-content-between mb-4">
                                <h6 class="mb-0">To Do List</h6>
                                <a href="">Show All</a>
                            </div>
                            <div class="d-flex mb-2">
                                <input class="form-control bg-dark border-0" type="text" placeholder="Enter task">
                                <button type="button" class="btn btn-primary ms-2">Add</button>
                            </div>
                            <div class="d-flex align-items-center border-bottom py-2">
                                <input class="form-check-input m-0" type="checkbox">
                                <div class="w-100 ms-3">
                                    <div class="d-flex w-100 align-items-center justify-content-between">
                                        <span>Short task goes here...</span>
                                        <button class="btn btn-sm"><i class="fa fa-times"></i></button>
                                    </div>
                                </div>
                            </div>
                            <div class="d-flex align-items-center border-bottom py-2">
                                <input class="form-check-input m-0" type="checkbox">
                                <div class="w-100 ms-3">
                                    <div class="d-flex w-100 align-items-center justify-content-between">
                                        <span>Short task goes here...</span>
                                        <button class="btn btn-sm"><i class="fa fa-times"></i></button>
                                    </div>
                                </div>
                            </div>
                            <div class="d-flex align-items-center border-bottom py-2">
                                <input class="form-check-input m-0" type="checkbox" checked>
                                <div class="w-100 ms-3">
                                    <div class="d-flex w-100 align-items-center justify-content-between">
                                        <span><del>Short task goes here...</del></span>
                                        <button class="btn btn-sm text-primary"><i class="fa fa-times"></i></button>
                                    </div>
                                </div>
                            </div>
                            <div class="d-flex align-items-center border-bottom py-2">
                                <input class="form-check-input m-0" type="checkbox">
                                <div class="w-100 ms-3">
                                    <div class="d-flex w-100 align-items-center justify-content-between">
                                        <span>Short task goes here...</span>
                                        <button class="btn btn-sm"><i class="fa fa-times"></i></button>
                                    </div>
                                </div>
                            </div>
                            <div class="d-flex align-items-center pt-2">
                                <input class="form-check-input m-0" type="checkbox">
                                <div class="w-100 ms-3">
                                    <div class="d-flex w-100 align-items-center justify-content-between">
                                        <span>Short task goes here...</span>
                                        <button class="btn btn-sm"><i class="fa fa-times"></i></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Widgets End -->
            <script src="{{url_for('static',filename='lib/chart/chart.min.js')}}"></script>
            <script>

                async function getRequest(url = '') {
                    const response = await fetch(url, {
                        method: 'GET',
                        cache: 'no-cache'
                    })
                    return response.json()
                }
                document.addEventListener('DOMContentLoaded', function () {
                    let url = document.location
                    let route = "/flaskwebgui-keep-server-alive"
                    let interval_request = 3 * 1000 //sec
                    function keep_alive_server() {
                        getRequest(url + route)
                            .then(data => console.log(data))
                    }
                    setInterval(keep_alive_server, interval_request)()
                })



                // Fetches the current CPU performance and updates the 
                // "cpu" HTML element with the result.
            function updateCpuPeformance(){
             
                 let url = "{{ url_for('get_cpu_perf_view')}}"

                fetch(url).then(
                    (resp) => { 
                        
                        return resp.json()

                    }).then((data) => {

                    //console.log(data)

                    document.getElementById("cpu").innerHTML = data.toString()

                    
                }).catch(   

                  err => console.error(err)
                );  
            }

            
           const ctx = document.getElementById('cpu-performance-chart').getContext('2d');
           const now = new Date().toLocaleTimeString();
           const chart1 = new Chart(ctx, {
            type: "bar",
            data: {
                labels:[now] ,
                datasets: [{
                        label: "Min",
                        data: [{{freq["min"]}}],
                        backgroundColor: "green"
                    },
                    {
                        label: "Current",
                        data: [{{freq["current"]}}],
                        backgroundColor: "orange"
                    },
                    {
                        label: "Max",
                        data: [{{freq["max"]}}],
                        backgroundColor: "red"
                    }
                ]
                },
            options: {
                responsive: true
            }
        });

       
        const ctx1 = document.getElementById('cpu-temp-chart').getContext('2d');
          const chart2 =  new Chart(ctx1, {
            type: "line",
            data: {
                labels:[now] ,
                datasets: [{
                        label: "Temperature",
                        data: [{{temp}}],
                        backgroundColor: "rgba(235, 22, 22, .7)",
                        borderColor: "red",
                        fill: false
                    },
                    
                ]
                },
            options: {
                responsive: true
            }
        });


/**
 * Fetches the current CPU performance and updates the CPU performance chart
 * with the result. This function is intended to be called at regular intervals
 * to update the chart with live data.
 */
        async function updateChartData(){
             
            let url = "{{ url_for('get_chart_data')}}"

           await fetch(url).then(
               (resp) => { 
                   
                   return resp.json()



               }).then((data) => {

                const now = new Date().toLocaleTimeString();

                console.log(data)

                chart1.data.labels.push(now)

                chart1.data.datasets[0].data.push(data.min)
                chart1.data.datasets[1].data.push(data.current)
                chart1.data.datasets[2].data.push(data.max)
               

                if (chart1.data.labels.length > 10) {
                    chart1.data.labels.shift();
                    chart1.data.datasets[0].data.shift();
                    chart1.data.datasets[1].data.shift();
                    chart1.data.datasets[2].data.shift();
                  }

                chart1.update();


              
           }).catch(   

             err => console.error(err)
           );  
       }

       setInterval(updateChartData, 10000);

       
/*************  *************/
                /**
                 * Fetches the current temperature from the server and updates the UI.
                 *  
                 * Fetches the JSON response from the server, parses it, and updates
                 * the #temp element with the current temperature.
                 *  
                 * @throws Error if there is a network error.
                 */

                 function updateTemp(){
             
                    let url = "{{ url_for('get_temp_view')}}"
   
                   fetch(url).then(
                       (resp) => { 
                           
                           return resp.json()
   
                       }
                   ).then((data) => {
   
                    console.log(data)

                    document.getElementById("temp").innerHTML = data["temp"].toString() + " °C";

                    const now = new Date().toLocaleTimeString();

                    chart2.data.labels.push(now)

                    chart2.data.datasets[0].data.push(data.temp)

                    if (chart2.data.labels.length > 10) {
                        chart2.data.labels.shift();
                        chart2.data.datasets[0].data.shift();
                      }

                    chart2.update()

   
                    
   
   
                   }).catch(
   
                        err => console.error(err)
                   );
   
               }
   
            setInterval(updateTemp, 10000);

/**
 * Fetches the current download and upload speeds from the server and updates
 * the UI with the retrieved data.
 * 
 * The function makes a request to the server endpoint to get the current
 * download and upload speeds, and updates the #download HTML element
 * with the speeds in Mbps.
 * 
 * @throws Error if there is a network error while fetching the data.
 */

            async function updateDownloadUploadSpeed(){
             
                let url = "{{ url_for('get_download_upload_speed_view')}}"
   
               await fetch(url).then(
                   (resp) => { 
                       
                       return resp.json()
   
                   }
               ).then((data) => {
   
                console.log(data)


                document.getElementById("network").innerHTML ="<i class='fa fa-download'></i> &nbsp;"+data["download_speed"].toString()+" / "+ "<i class='fa fa-upload'></i> &nbsp;"+data["upload_speed"].toString();
                

               })

            }

            setInterval(updateDownloadUploadSpeed, 10000);


    



            </script>
{% endblock content %}

